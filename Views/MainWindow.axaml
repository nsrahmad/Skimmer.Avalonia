<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:av="clr-namespace:TheArtOfDev.HtmlRenderer.Avalonia;assembly=Avalonia.HtmlRenderer"
        xmlns:dialogHost="clr-namespace:DialogHostAvalonia;assembly=DialogHost.Avalonia"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:conv="clr-namespace:Skimmer.Avalonia.Converters"
        xmlns:views="clr-namespace:Skimmer.Avalonia.Views"
        xmlns:viewModels="clr-namespace:Skimmer.Core.ViewModels;assembly=Skimmer.Core"
        mc:Ignorable="d" d:DesignWidth="950" d:DesignHeight="450"
        xmlns:actipro="http://schemas.actiprosoftware.com/avaloniaui"
        xmlns:actiproPrims="using:ActiproSoftware.UI.Avalonia.Controls.Primitives"
        x:Class="Skimmer.Avalonia.Views.MainWindow"
        x:DataType="viewModels:MainWindowViewModel"
        Icon="/Assets/Skimmer.ico"
        Title="Skimmer">

    <Design.DataContext>
        <!-- This only sets the DataContext for the previewer in an IDE,
             to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs) -->
        <viewModels:MainWindowViewModel />
    </Design.DataContext>

    <Window.Resources>
        <conv:ThemeColorConverter x:Key="ThemeColorConverter" />
    </Window.Resources>

    <dialogHost:DialogHost CloseOnClickAway="True"
                           Background="{actipro:ThemeResource DefaultBackgroundBrush}"
                           IsOpen="{Binding IsAddDialogOpen}">
        <dialogHost:DialogHost.DialogContent>
            <!-- put your dialog content here-->
            <StackPanel Orientation="Vertical">
                <Label>Enter Feed URL</Label>
                <StackPanel Orientation="Horizontal">
                    <TextBox Text="{Binding Url, Mode=OneWayToSource}"
                             Width="300" />
                    <Button
                        Margin="8 0 0 0"
                        Command="{Binding AddNewFeedCommand}"
                        CommandParameter="{Binding Url}">
                        Add
                    </Button>
                </StackPanel>
            </StackPanel>
        </dialogHost:DialogHost.DialogContent>
        <!-- put the content over which the dialog is shown here (e.g. your main window grid)-->

        <DockPanel>
            <!-- Title Bar -->
            <actipro:WindowTitleBar DockPanel.Dock="Top" BorderThickness="0,0,0,1" Padding="0">
                <actipro:WindowTitleBar.Resources>
                    <actipro:ComparisonConverter x:Key="RightContentMarginConverter">
                        <actipro:ComparisonConverter.TrueResult>
                            <OnPlatform>
                                <OnPlatform.macOS>
                                    <Thickness>0,0,0,0</Thickness>
                                </OnPlatform.macOS>
                                <OnPlatform.Default>
                                    <Thickness>0,0,20,0</Thickness>
                                </OnPlatform.Default>
                            </OnPlatform>
                        </actipro:ComparisonConverter.TrueResult>
                        <actipro:ComparisonConverter.FalseResult>
                            <Thickness>0,0,0,0</Thickness>
                        </actipro:ComparisonConverter.FalseResult>
                    </actipro:ComparisonConverter>
                </actipro:WindowTitleBar.Resources>
                <actiproPrims:OverlayInputFilter>
                    <StackPanel Orientation="Horizontal"
                                Margin="8 0">
                        <Image DockPanel.Dock="Left" Width="24" Height="24" Source="/Assets/Skimmer.ico"
                               VerticalAlignment="Center" IsHitTestVisible="False">
                            <Image.Effect>
                                <DropShadowEffect OffsetX="0" OffsetY="1" BlurRadius="3"
                                                  Opacity="{DynamicResource {actipro:ThemeResourceKey ShadowOpacity}}" />
                            </Image.Effect>
                        </Image>

                        <StackPanel Margin="10,7,0,7" VerticalAlignment="Center" IsHitTestVisible="False">
                            <TextBlock Text="An Atom/RSS Feed Reader" FontSize="12" TextTrimming="CharacterEllipsis"
                                       Opacity="0.85" />
                            <TextBlock Margin="0,-2,0,0" Text="Skimmer" FontSize="18" FontWeight="SemiBold"
                                       TextTrimming="CharacterEllipsis" />
                        </StackPanel>
                    </StackPanel>
                </actiproPrims:OverlayInputFilter>

                <actipro:WindowTitleBar.RightContent>
                    <actiproPrims:OverlayInputFilter>
                        <StackPanel
                            Margin="{Binding $parent[actipro:WindowTitleBar].HasCaptionButtons, Converter={StaticResource RightContentMarginConverter}}"
                            Orientation="Horizontal">
                            <Button Content="&#x002B;"
                                    ToolTip.Tip="Add a new feed with URL"
                                    Theme="{actipro:ControlTheme TitleBarButton}"
                                    FontSize="24"
                                    FontWeight="Light"
                                    VerticalAlignment="Stretch"
                                    VerticalContentAlignment="Top"
                                    Command="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType=dialogHost:DialogHost}, Path=OpenDialogCommand}" />
                            <Button Content="&#x27F3;"
                                    ToolTip.Tip="Update All Feeds"
                                    VerticalAlignment="Stretch"
                                    FontWeight="Light"
                                    VerticalContentAlignment="Top"
                                    FontSize="24"
                                    Theme="{actipro:ControlTheme TitleBarButton}"
                                    Command="{Binding UpdateAllFeedsCommand}" />
                            <actipro:ToggleThemeButton
                                Theme="{actipro:ControlTheme TitleBarToggleThemeButton}"
                                ToolTip.Tip="Toggle Theme" />
                        </StackPanel>
                    </actiproPrims:OverlayInputFilter>
                </actipro:WindowTitleBar.RightContent>
            </actipro:WindowTitleBar>

            <!-- Status Bar -->
            <actiproPrims:OverlayInputFilter DockPanel.Dock="Bottom">
                <Border Background="{actipro:ThemeResource StatusBarBackgroundBrush}"
                        BorderBrush="{actipro:ThemeResource StatusBarBorderBrush}"
                        BorderThickness="{actipro:ThemeResource StatusBarBorderThickness}"
                        TextElement.Foreground="{actipro:ThemeResource StatusBarForegroundBrush}">
                    <DockPanel Margin="0,0,0,1">
                        <TextBlock Margin="{actipro:ScaledThickness '2.5,0.5'}" Text="{Binding StatusMessage}" />
                        <actipro:WindowResizeGrip DockPanel.Dock="Right" />
                    </DockPanel>
                </Border>
            </actiproPrims:OverlayInputFilter>

            <Grid ColumnDefinitions="Auto,Auto,Auto,Auto,*"
                  RowDefinitions="Auto,Auto,*">

                <views:FeedDirectoryViewControl DataContext="{Binding }"
                                                MinWidth="150"
                                                Grid.Row="1"
                                                Grid.Column="0"
                                                Grid.RowSpan="2" />
                <GridSplitter Grid.Row="0" Grid.Column="1" Grid.RowSpan="3" />

                <views:FeedItemsListView DataContext="{Binding }"
                                         Grid.Row="1"
                                         Grid.Column="2"
                                         Grid.RowSpan="2" />
                <GridSplitter Grid.Row="0" Grid.Column="3" Grid.RowSpan="3" Width="2" />
                <Border Grid.Row="0" Grid.Column="4"
                        Grid.RowSpan="3"
                        Margin="4"
                        BorderBrush="{actipro:ThemeResource Container1BorderBrush}"
                        CornerRadius="{StaticResource {actipro:ThemeResourceKey CardCornerRadius}}"
                        Padding="{StaticResource {actipro:ThemeResourceKey CardPadding}}"
                        BorderThickness="{StaticResource {actipro:ThemeResourceKey CardBorderThickness}}">
                    <DockPanel>
                        <Border Margin="0 0 0 8"
                                DockPanel.Dock="Top">
                            <StackPanel>
                                <TextBlock Text="{Binding SelectedFeedItem.Title}"
                                           TextWrapping="Wrap"
                                           FontSize="16" />
                                <actipro:HyperlinkTextBlock
                                    Text="{Binding SelectedFeedItem.Link}"
                                    TextWrapping="Wrap"
                                    ToolTip.Tip="Open in Default Browser" />
                            </StackPanel>
                        </Border>
                        <av:HtmlPanel
                            Text="{Binding SelectedFeedItem.Description, Converter={StaticResource ThemeColorConverter}}"
                            AvoidImagesLateLoading="False" />
                    </DockPanel>
                </Border>
            </Grid>
        </DockPanel>
    </dialogHost:DialogHost>
</Window>
